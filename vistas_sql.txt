AQUÍ SE PUBLICARÁ LAS CREACIONES DE VISTAS Y/O PROCEDIMIENTOS DE LA BASE DE DATOS

create view v_usuario as
select u.codi_usu,
u.codi_rol,
u.reg_usu,
r.nomb_rol,
u.nomb_usu,
u.pass_usu,
u.acce_usu,
u.ses_usu,
u.esta_usu
from usuario u, rol r
where u.codi_rol = r.codi_rol 
order by u.codi_usu asc;

CREATE VIEW v_producto AS
SELECT p.codi_prod,
p.codi_tpro,
tp.nomb_tipo,
p.nomb_prod,
p.prec_prod,
p.fein_prod,
p.fesa_prod,
p.stoc_prod,
p.esta_prod,
p.obsv_prod
FROM producto p, tipo_producto tp 
ORDER BY p.codi_prod ASC;

create view v_caja_dia as
select cd.codi_cad,
cd.codi_caj,
c.num_caj,
cd.fein_cad,
cd.usin_cad,
ui.nomb_usu AS usu_ini,
cd.sain_cad,
cd.fefi_cad,
cd.usfi_cad,
uf.nomb_usu AS usu_fin,
cd.safi_cad,
cd.obsv_cad,
cd.esta_cad
from caja c, caja_dia cd, usuario ui, usuario uf
where cd.codi_caj = c.codi_caj
and cd.usin_cad = ui.codi_usu
and cd.usfi_cad = uf.codi_usu
order by cd.codi_caj asc


SELECT 
c.codi_caj,
c.num_caj,
(SELECT 
cd.codi_cad,
cd.fein_cad,
cd.usin_cad,
ui.nomb_usu,
cd.sain_cad,
MAX(cd.fefi_cad) as Maxdatetime,
cd.usfi_cad,
uf.nomb_usu,
cd.safi_cad,
cd.obsv_cad,
cd.esta_Cad
from caja c, caja_dia cd, usuario ui, usuario uf
where cd.codi_caj = c.codi_caj
and cd.usin_cad = ui.codi_usu
and cd.usfi_cad = uf.codi_usu
group by Maxdatetime) as 
WHERE c.codi_caj = cd.codi_caj
ORDER BY cd.codi_caj asc

SELECT 
c.codi_caj,
c.num_caj,
(SELECT MAX(cd.fein_cad)
FROM caja_dia cd
WHERE cd.codi_caj = c.codi_caj) AS fein_cad,
(SELECT MAX(cd.fefi_cad)
FROM caja_dia cd
WHERE cd.codi_caj = c.codi_caj) AS fefi_cad,
c.fech_caj,
c.obsv_caj,
c.esta_caj
FROM caja c
ORDER BY c.codi_caj ASC